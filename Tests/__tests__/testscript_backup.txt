const [uploadData,search,updateData,deleteData,uploadKeyG,encryptUploadBlob,downloadDecryptBlob] = require("../../sse/static/js/sse.js");

const input1 = { "firstname": "David" };
const file_id1 = "1";

const input2 = { "firstname": "David" , "lastname":"White"};//, "age":25};
const file_id2 = "2";

const file_id3 = "3";

const nfound1 = 1; // after inserting input1
const nfound2 = 2;  // after inserting input2
const nfound3 = 0; // after deleting 2 files

const KeyG="123";
const Kenc = "123";

const criteria1 = { "keyword": "firstname|David" };
const criteria2 = { "keyword": "firstname|Peter" };
const criteria3 = { "keyword": "lastname|Yellow" };

const update1 = {"firstname":["Mary","Peter"]};
const update2 = {"firstname":["David","Peter"]};
const update3 = {"firstname":["David","Peter"],"lastname":["Black","Yellow"]};
const update4 = {"firstname":["David","Peter"],"lastname":["White","Yellow"]};

const fpath_docx = "data/astronomy.docx"
const fname_docx = "astronomy.docx"
const ftype_docx = "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
	
const fpath_txt="data/poem.txt"
const fname_txt = "poem.txt";
const ftype_txt = "text/plain";

const fpath_pdf="data/comparision.pdf"
const fname_pdf = "comparision.pdf";
const ftype_pdf = "application/pdf";

const fpath_pptx="data/micado.pptx"
const fname_pptx = "micado.pptx";
const ftype_pptx = "application/vnd.openxmlformats-officedocument.presentationml.presentation";
	
const fpath_png="data/italianfood.png"
const fname_png = "italianfood.png";
const ftype_png = "image/png";

const fpath_jpg="data/christmas.jpg"
const fname_jpg = "christmas.jpg";
const ftype_jpg = "image/jpg";

const fpath_mov="data/MVI_5416.MOV"
const fname_mov = "MVI_5416.MOV";
const ftype_mov = "video/quicktime";

const fpath_xlsx="data/uow_travels.xlsx"
const fname_xlsx = "uow_travels.xlsx";
const ftype_xlsx = "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";
	
const fpath_cdm="data/IMG5.dcm"
const fname_cdm = "IMG5.dcm";
const ftype_cdm = "application/dicom";
	
window.URL.createObjectURL = function() {};
window.URL.revokeObjectURL = function() {};

const jsdom = require("jsdom");
const { JSDOM } = jsdom;
	
//describe("upload shared key to TA",() => {
//	test("upload shared key to TA should return true", () => {
//		var result = uploadKeyG(KeyG);
//		expect(result).toEqual(true);
//	});
//});

//describe("upload and search", () => {
//	test("search for non-existed data should return not found", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(0);	
//	});
//	test("it should upload json object successfully", done => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//				done();
//			} catch (error) {
//				console.log("errors")
//				done(error);
//			}
//		};
//		uploadData(input1,file_id1,KeyG,Kenc,callback);    
//	});
//	
//	test("2nd search for uploaded data should return found results", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound1);
//	});
//  
//	test("it should not upload json object with existed file id (uRl)", () => {;
//		expect(uploadData(input1,file_id1,KeyG,Kenc)).toEqual(false);
//	});
//
//	test("it should upload json object with more than 1 field successfully", done => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//				done();
//			} catch (error) {
//				console.log("errors")
//				done(error);
//			}
//		};
//		uploadData(input2,file_id2,KeyG,Kenc,callback);    
//	});	
//	test("search for uploaded data should return at least 2 found results", ()  => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound2);
//	});
//
//});
//
//describe("update and search", () => {
//	test("update one non-existed value should return false", () => {
//		var result = updateData(update1,file_id1,KeyG,Kenc);
//		expect(result).toEqual(false);
//	});
//	test("update one existed value should return true", done => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//				done();
//			} catch (error) {
//				console.log("errors")
//				done(error);
//			}
//		};
//		updateData(update2,file_id1,KeyG,Kenc,callback);
//	});
//	test("search updated value should return 1 found result", () => {
//		var result = search(criteria2,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound1);
//	});
//	
//	test("search previous value should return 1 found result", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound1);
//	});
//	test("update a pair of values, one among which does not exist, should return false", ()  => {
//		var result = updateData(update3,file_id2,KeyG,Kenc);
//		expect(result).toEqual(false);
//	});
//	test("update a pair of existed values should return true", done => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//				done();
//			} catch (error) {
//				console.log("errors")
//				done(error);
//			}
//		};
//		updateData(update4,file_id2,KeyG,Kenc,callback);
//	});
//	test("search updated value should return 2 found result", () => {
//		var result = search(criteria2,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound2);
//	});
//	test("search updated new value should return 1 found result", () => {
//		var result = search(criteria3,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound1);
//	});
//	test("search previous value should return not found", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(0);
//	});
//});
//
//describe("delete and search", () => {
//	test("delete one non-existed file_id should return false", () => {
//		var result = deleteData(file_id3,KeyG,Kenc);
//		expect(result).toEqual(false);
//	});
//	test("delete one existed value should return true", done => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//				done();
//			} catch (error) {
//				console.log("errors")
//				done(error);
//			}
//		};
//		deleteData(file_id1,KeyG,Kenc,callback);
//	});
//	test("search value should return 1 found result", () => {
//		var result = search(criteria2,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound1);
//	});
//	test("delete one existed value should return true", done => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//				done();
//			} catch (error) {
//				console.log("errors")
//				done(error);
//			}
//		};
//		deleteData(file_id2,KeyG,Kenc,callback);
//	});
//	test("search value should return 0 found result", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound3);
//	});
//});

describe("upload blob", () => {
	test("upload txt file returns true", async () => {
		function callback(data) {
			try {
				expect(data).toBe(true);
				//done();
			} catch (error) {
				console.log("errors");
				done(error);
			}
		};
		
		var fs = require('fs');
		 
		var contents = fs.readFileSync(fpath_txt, 'utf8');
		console.log("contents:",contents);	
	    var blobData = new Blob([contents], {type: ftype_txt});	        
	    await encryptUploadBlob(blobData,fname_txt,Kenc,callback);
	});
	test("upload docx file returns true", async () => {
		function callback(data) {
			try {
				expect(data).toBe(true);
				//done();
			} catch (error) {
				console.log("errors");
				done(error);
			}
		};
		
		var fs = require('fs');
		 
		var contents = fs.readFileSync(fpath_docx, 'utf8');
		console.log("contents:",contents);	
	    var blobData = new Blob([contents], {type: ftype_docx});	        
	    await encryptUploadBlob(blobData,fname_docx,Kenc,callback);
	});
	test("upload pdf file returns true", async () => {
		function callback(data) {
			try {
				expect(data).toBe(true);
				//done();
			} catch (error) {
				console.log("errors");
				done(error);
			}
		};
		
		var fs = require('fs');
		 
		var contents = fs.readFileSync(fpath_pdf, 'utf8');
		console.log("contents:",contents);	
	    var blobData = new Blob([contents], {type: ftype_pdf});	        
	    await encryptUploadBlob(blobData,fname_pdf,Kenc,callback);
	});
	test("upload png file returns true", async () => {
		function callback(data) {
			try {
				expect(data).toBe(true);
				//done();
			} catch (error) {
				console.log("errors");
				done(error);
			}
		};
		
		var fs = require('fs');
		 
		var contents = fs.readFileSync(fpath_png, 'utf8');
		console.log("contents:",contents);	
	    var blobData = new Blob([contents], {type: ftype_png});	        
	    await encryptUploadBlob(blobData,fname_png,Kenc,callback);
	});
	test("upload jpg file returns true", async () => {
		function callback(data) {
			try {
				expect(data).toBe(true);
				//done();
			} catch (error) {
				console.log("errors");
				done(error);
			}
		};
		
		var fs = require('fs');
		 
		var contents = fs.readFileSync(fpath_jpg, 'utf8');
		console.log("contents:",contents);	
	    var blobData = new Blob([contents], {type: ftype_jpg});	        
	    await encryptUploadBlob(blobData,fname_jpg,Kenc,callback);
	});
	test("upload pptx file returns true", async () => {
		function callback(data) {
			try {
				expect(data).toBe(true);
				//done();
			} catch (error) {
				console.log("errors");
				done(error);
			}
		};
		
		var fs = require('fs');
		 
		var contents = fs.readFileSync(fpath_pptx, 'utf8');
		console.log("contents:",contents);	
	    var blobData = new Blob([contents], {type: ftype_pptx});	        
	    await encryptUploadBlob(blobData,fname_pptx,Kenc,callback);
	});
	test("upload xlsx file returns true", async () => {
		function callback(data) {
			try {
				expect(data).toBe(true);
				//done();
			} catch (error) {
				console.log("errors");
				done(error);
			}
		};
		
		var fs = require('fs');
		 
		var contents = fs.readFileSync(fpath_xlsx, 'utf8');
		console.log("contents:",contents);	
	    var blobData = new Blob([contents], {type: ftype_xlsx});	        
	    await encryptUploadBlob(blobData,fname_xlsx,Kenc,callback);
	});
	test("upload cdm file returns true", async () => {
		function callback(data) {
			try {
				expect(data).toBe(true);
				//done();
			} catch (error) {
				console.log("errors");
				done(error);
			}
		};
		
		var fs = require('fs');
		 
		var contents = fs.readFileSync(fpath_cdm, 'utf8');
		console.log("contents:",contents);	
	    var blobData = new Blob([contents], {type: ftype_cdm});	        
	    await encryptUploadBlob(blobData,fname_cdm,Kenc,callback);
	});
//	test("upload mov file returns true", async () => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//				//done();
//			} catch (error) {
//				console.log("errors");
//				done(error);
//			}
//		};
//		
//		var fs = require('fs');
//		 
//		var contents = fs.readFileSync(fpath_mov, 'utf8');
//		console.log("contents:",contents);	
//	    var blobData = new Blob([contents], {type: ftype_mov});	        
//	    await encryptUploadBlob(blobData,fname_mov,Kenc,callback);
//	});
//	test("download txt file returns true", async () => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//			} catch (error) {
//				console.log("errors")
//				done(error);
//			}
//		};
//		
////		function saveBlob(blob, fileName) {
////			console.log("save file")
////			console.log(blob)
////			 var a = document.createElement("a");
////			 document.body.appendChild(a);
////			 a.style = "display: none";
////			 var url = window.URL.createObjectURL(blob);
////			 a.href = url;
////			 a.download = fileName;
////			 a.click();
////			 console.log("click")
////			 window.URL.revokeObjectURL(url);
////		};
//	
////		var promise = downloadDecryptBlob(fname_txt,Kenc,callback);
////		promise.then(function(data) {
////			//saveBlob(data,fname_txt)
////			console.log(data)
////		});
////		return promise;
//		await downloadDecryptBlob(fname_txt,Kenc,callback);
//	});
////		return Promise.resolve(downloadDecryptBlob(fname_txt,Kenc,callback))
////			    .then(() => {})
////			    .then(() => {});
});
	
//	test("upload docx file returns true", async () => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//				//done();
//			} catch (error) {
//				console.log("errors");
//				done(error);
//			}
//		};
//		
//		var fs = require('fs');
//		 
//		var contents = fs.readFileSync(fpath_docx, 'binary').toString('utf8');;
//		console.log("contents:",contents);	
//	    var blobData = new Blob([contents], {type: ftype_docx});	        
//	    await encryptUploadBlob(blobData,fname_docx,Kenc,callback);
//	});
//	test("download pdf file returns true", done => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//				done();
//			} catch (error) {
//				console.log("errors")
//				done(error);
//			}
//		};
//		deleteData(file_id1,KeyG,Kenc,callback);
//	});
//	test("upload docx file returns true", () => {
//		var result = search(criteria2,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound1);
//	});
//	test("download docx file returns true", done => {
//		function callback(data) {
//			try {
//				expect(data).toBe(true);
//				done();
//			} catch (error) {
//				console.log("errors")
//				done(error);
//			}
//		};
//		deleteData(file_id2,KeyG,Kenc,callback);
//	});
//	test("upload xlsx file returns true", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound3);
//	});
//	test("download xlsx file returns true", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound3);
//	});
//	test("upload png file returns true", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound3);
//	});
//	test("download png file returns true", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound3);
//	});
//	test("upload jpg file returns true", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound3);
//	});
//	test("download jpg file returns true", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound3);
//	});
//	test("upload avi file returns true", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound3);
//	});
//	test("download avi file returns true", () => {
//		var result = search(criteria1,KeyG,Kenc);
//		expect(result["count"]).toEqual(nfound3);
//	});
//});


